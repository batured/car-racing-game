<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Android Car Racer</title>
    <style>
        /* --- General Setup --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #282c34;
            overflow: hidden; /* Prevents scrollbars */
        }

        /* --- Game Container --- */
        .game-container {
            width: 100%;
            max-width: 420px; /* Optimal width for mobile phones */
            height: 100vh;
            background-color: #3d3d3d; /* Dark gray for the road shoulders */
            position: relative;
            overflow: hidden;
            border-left: 10px solid #636e72;
            border-right: 10px solid #636e72;
        }

        /* --- Screens (Start/Game Over) --- */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            z-index: 10;
            text-align: center;
            padding: 20px;
        }

        .screen h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .screen p {
            font-size: 1.2rem;
            margin-bottom: 25px;
        }

        /* --- Car Selection --- */
        .car-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .car-option {
            width: 70px;
            height: 70px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 10px;
            transition: transform 0.2s, border-color 0.2s;
        }

        .car-option:hover {
            transform: scale(1.1);
        }

        .car-option.selected {
            border-color: #0984e3;
            transform: scale(1.1);
        }
        
        /* Using inline SVG for car graphics to keep it to a single file */
        #sports-car { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect x="20" y="30" width="160" height="50" fill="%23d63031"/><rect x="50" y="10" width="100" height="30" fill="%23d63031"/><circle cx="60" cy="85" r="15" fill="black"/><circle cx="140" cy="85" r="15" fill="black"/></svg>'); }
        #police-car { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect x="20" y="30" width="160" height="50" fill="%230984e3"/><rect x="50" y="10" width="100" height="30" fill="white"/><rect x="90" y="0" width="20" height="10" fill="red"/><circle cx="60" cy="85" r="15" fill="black"/><circle cx="140" cy="85" r="15" fill="black"/></svg>'); }
        #truck { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 120"><rect x="10" y="40" width="180" height="60" fill="%23fdcb6e"/><rect x="120" y="10" width="70" height="40" fill="%23fdcb6e"/><circle cx="50" cy="105" r="15" fill="black"/><circle cx="150" cy="105" r="15" fill="black"/></svg>'); }

        /* --- Buttons --- */
        .button {
            padding: 15px 40px;
            font-size: 1.5rem;
            cursor: pointer;
            background-color: #0984e3;
            color: white;
            border: none;
            border-radius: 8px;
            text-transform: uppercase;
            transition: background-color 0.3s;
        }
        
        .button:hover {
            background-color: #74b9ff;
        }

        /* --- Game Elements --- */
        .score {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 2rem;
            font-weight: bold;
            z-index: 5;
            text-shadow: 2px 2px 4px black;
        }
        
        .road {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 85%;
            height: 100%;
            background-color: #b2bec3;
            /* Dashed lines are created with JS */
        }

        .line {
            width: 10px;
            height: 60px;
            background-color: white;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .player, .obstacle {
            position: absolute;
            width: 50px;
            height: 80px; /* Taller hitbox */
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        .obstacle {
            width: 55px;
            height: 85px;
        }

        /* --- Touch Controls --- */
        .touch-controls {
            display: block; /* Always available for touch devices */
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%; /* Cover the whole screen for easy access */
            z-index: 6;
        }

        .touch-zone {
            position: absolute;
            top: 0;
            width: 50%;
            height: 100%;
        }

        .touch-left { left: 0; }
        .touch-right { right: 0; }
        
    </style>
</head>
<body>

    <div class="game-container">
        <!-- Start Screen -->
        <div class="screen" id="start-screen">
            <h1>Android Racer</h1>
            <p>Select your car and hit the road!</p>
            <div class="car-selection">
                <div class="car-option selected" id="sports-car" data-car="sports-car"></div>
                <div class="car-option" id="police-car" data-car="police-car"></div>
                <div class="car-option" id="truck" data-car="truck"></div>
            </div>
            <button class="button" id="start-button">Start Game</button>
        </div>

        <!-- Game Elements (populated by JS) -->
        <div class="score" id="score">Score: 0</div>
        <div class="road"></div>
        <div class="player" id="player"></div>

        <!-- Game Over Screen -->
        <div class="screen" id="game-over-screen" style="display: none;">
            <h1>Game Over</h1>
            <p id="final-score">Your Score: 0</p>
            <button class="button" id="restart-button">Restart</button>
        </div>

        <!-- Touch Controls -->
        <div class="touch-controls">
            <div class="touch-zone touch-left"></div>
            <div class="touch-zone touch-right"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References ---
            const gameContainer = document.querySelector('.game-container');
            const startScreen = document.getElementById('start-screen');
            const gameOverScreen = document.getElementById('game-over-screen');
            const carSelection = document.querySelector('.car-selection');
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            const scoreElement = document.getElementById('score');
            const finalScoreElement = document.getElementById('final-score');
            const road = document.querySelector('.road');
            const player = document.getElementById('player');
            const touchLeft = document.querySelector('.touch-left');
            const touchRight = document.querySelector('.touch-right');

            // --- Game State Variables ---
            let gameLoopId;
            let playerCar = 'sports-car';
            let score = 0;
            let gameSpeed = 3;
            const initialSpeed = 3;
            const maxSpeed = 12;
            let keys = { ArrowLeft: false, ArrowRight: false };
            let playerPosition = {
                x: gameContainer.offsetWidth / 2 - 25,
                y: gameContainer.offsetHeight - 120
            };
            
            // --- Car & Obstacle Graphics (as Data URIs) ---
            const carImages = {
                'sports-car': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect x="20" y="30" width="160" height="50" fill="%23d63031"/><rect x="50" y="10" width="100" height="30" fill="%23d63031"/><circle cx="60" cy="85" r="15" fill="black"/><circle cx="140" cy="85" r="15" fill="black"/></svg>',
                'police-car': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect x="20" y="30" width="160" height="50" fill="%230984e3"/><rect x="50" y="10" width="100" height="30" fill="white"/><rect x="90" y="0" width="20" height="10" fill="red"/><circle cx="60" cy="85" r="15" fill="black"/><circle cx="140" cy="85" r="15" fill="black"/></svg>',
                'truck': 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 120"><rect x="10" y="40" width="180" height="60" fill="%23fdcb6e"/><rect x="120" y="10" width="70" height="40" fill="%23fdcb6e"/><circle cx="50" cy="105" r="15" fill="black"/><circle cx="150" cy="105" r="15" fill="black"/></svg>'
            };
            const obstacleImages = [
                'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect x="20" y="30" width="160" height="50" fill="green"/><rect x="50" y="10" width="100" height="30" fill="green"/><circle cx="60" cy="85" r="15" fill="black"/><circle cx="140" cy="85" r="15" fill="black"/></svg>',
                'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect x="20" y="30" width="160" height="50" fill="purple"/><rect x="50" y="10" width="100" height="30" fill="purple"/><circle cx="60" cy="85" r="15" fill="black"/><circle cx="140" cy="85" r="15" fill="black"/></svg>',
                'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100"><rect x="20" y="30" width="160" height="50" fill="gray"/><rect x="50" y="10" width="100" height="30" fill="gray"/><circle cx="60" cy="85" r="15" fill="black"/><circle cx="140" cy="85" r="15" fill="black"/></svg>'
            ];

            // --- Event Listeners ---
            carSelection.addEventListener('click', (e) => {
                if (e.target.classList.contains('car-option')) {
                    document.querySelectorAll('.car-option').forEach(opt => opt.classList.remove('selected'));
                    e.target.classList.add('selected');
                    playerCar = e.target.dataset.car;
                    player.style.backgroundImage = `url("${carImages[playerCar]}")`;
                }
            });

            startButton.addEventListener('click', startGame);
            restartButton.addEventListener('click', () => {
                gameOverScreen.style.display = 'none';
                startScreen.style.display = 'flex';
            });
            
            // Keyboard Controls
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    e.preventDefault();
                    keys[e.key] = true;
                }
            });
            document.addEventListener('keyup', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
                    e.preventDefault();
                    keys[e.key] = false;
                }
            });
            
            // Touch Controls
            touchLeft.addEventListener('touchstart', (e) => { e.preventDefault(); keys.ArrowLeft = true; }, { passive: false });
            touchLeft.addEventListener('touchend', (e) => { e.preventDefault(); keys.ArrowLeft = false; });
            touchRight.addEventListener('touchstart', (e) => { e.preventDefault(); keys.ArrowRight = true; }, { passive: false });
            touchRight.addEventListener('touchend', (e) => { e.preventDefault(); keys.ArrowRight = false; });

            // --- Game Functions ---
            function init() {
                // Set default car
                document.querySelector('.car-option#sports-car').classList.add('selected');
                playerCar = 'sports-car';
                player.style.backgroundImage = `url("${carImages[playerCar]}")`;
                player.style.top = playerPosition.y + 'px';
                player.style.left = playerPosition.x + 'px';
            }

            function resetGame() {
                score = 0;
                gameSpeed = initialSpeed;
                scoreElement.innerHTML = `Score: ${score}`;
                
                // Reset player position
                playerPosition.x = gameContainer.offsetWidth / 2 - 25;
                player.style.left = playerPosition.x + 'px';

                // Clear old game elements
                document.querySelectorAll('.obstacle').forEach(o => o.remove());
                document.querySelectorAll('.line').forEach(l => l.remove());

                // Select the current car again
                player.style.backgroundImage = `url("${carImages[playerCar]}")`;
            }
            
            function startGame() {
                startScreen.style.display = 'none';
                resetGame();
                gameLoopId = requestAnimationFrame(gameLoop);
            }

            function gameLoop() {
                updateGameElements();
                handlePlayerMovement();
                checkCollision();

                score++;
                if (gameSpeed < maxSpeed) {
                    gameSpeed += 0.003; // Difficulty scaling
                }
                scoreElement.innerHTML = `Score: ${score}`;

                gameLoopId = requestAnimationFrame(gameLoop);
            }
            
            function updateGameElements() {
                // Move road lines
                let lines = document.querySelectorAll('.line');
                lines.forEach(line => {
                    let top = line.offsetTop;
                    if (top >= gameContainer.offsetHeight) {
                        line.remove();
                    } else {
                        line.style.top = top + gameSpeed + 'px';
                    }
                });
                
                // Create new road lines
                if (Math.random() > 0.5) { // Control line density
                    if (!document.querySelector('.line') || document.querySelector('.line').offsetTop > 150) {
                        createLine();
                    }
                }
                
                // Move obstacles
                let obstacles = document.querySelectorAll('.obstacle');
                obstacles.forEach(obstacle => {
                    let top = obstacle.offsetTop;
                    if (top > gameContainer.offsetHeight) {
                        obstacle.remove();
                    } else {
                        obstacle.style.top = top + gameSpeed + 'px';
                    }
                });

                // Create new obstacles
                const obstacleSpawnRate = 1 - (gameSpeed / maxSpeed) * 0.03; // Obstacles become more frequent
                if (Math.random() > obstacleSpawnRate && document.querySelectorAll('.obstacle').length < 5) {
                   createObstacle();
                }
            }

            function createLine() {
                const line = document.createElement('div');
                line.setAttribute('class', 'line');
                line.style.top = '-80px';
                road.appendChild(line);
            }
            
            function createObstacle(){
                const obstacle = document.createElement('div');
                obstacle.setAttribute('class', 'obstacle');
                obstacle.style.top = '-100px';
                
                const roadLeft = road.offsetLeft;
                const roadWidth = road.offsetWidth;
                obstacle.style.left = Math.floor(Math.random() * (roadWidth - 55)) + roadLeft + 'px'; // 55 is obstacle width
                
                obstacle.style.backgroundImage = `url("${obstacleImages[Math.floor(Math.random() * obstacleImages.length)]}")`;
                gameContainer.appendChild(obstacle);
            }

            function handlePlayerMovement() {
                const roadRect = road.getBoundingClientRect();
                const playerWidth = player.offsetWidth;
                const playerSpeed = 5;

                if (keys.ArrowLeft && playerPosition.x > roadRect.left - gameContainer.offsetLeft) {
                    playerPosition.x -= playerSpeed;
                }
                if (keys.ArrowRight && playerPosition.x < (roadRect.right - gameContainer.offsetLeft) - playerWidth) {
                    playerPosition.x += playerSpeed;
                }
                player.style.left = playerPosition.x + 'px';
            }

            function checkCollision() {
                const obstacles = document.querySelectorAll('.obstacle');
                const playerRect = player.getBoundingClientRect();

                obstacles.forEach(obstacle => {
                    const obstacleRect = obstacle.getBoundingClientRect();
                    // Simple AABB collision detection
                    if (playerRect.left < obstacleRect.right &&
                        playerRect.right > obstacleRect.left &&
                        playerRect.top < obstacleRect.bottom &&
                        playerRect.bottom > obstacleRect.top) {
                        endGame();
                    }
                });
            }

            function endGame() {
                cancelAnimationFrame(gameLoopId);
                gameOverScreen.style.display = 'flex';
                finalScoreElement.innerText = `Your Score: ${score}`;
            }

            // --- Initialise Game ---
            init();
        });
    </script>
</body>
</html>
